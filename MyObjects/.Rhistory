distribution.model="std")
mod_standard_garch <- ugarchfit(
spec=spec_rugarch4, data=spyreal[, 1], solver="hybrid")
infocriteria(mod_gjr)["Akaike",]
infocriteria(mod_standard_garch)["Akaike",]
d_xts <- spyreal[, 1]
d_xts
d_xts$volatility <- sigma(mod_gjr)
d_xts$volatility <- sigma(mod_gjr)
autoplot(d_xts, facets=T, ylab="")
?Arima
# アークダイアグラム
install.packages("devtools")
install.packages("devtools")
install.packages("devtools")
install.packages("devtools")
library(devtools)
install_github("gastonstat/arcdiagram")
library("devtools", lib.loc="C:/Users/mas/Anaconda3/envs/nw_env/Lib/R/library")
install_github('arcdiagram', username='gastonstat')
install_github("gastonstat/arcdiagram")
.libPaths()
install.packages("rlang")
install.packages("rlang")
# アークダイアグラム
install.packages("devtools")
library(devtools)
install_github("gastonstat/arcdiagram")
library(arcdiagram)
library("rlang", lib.loc="C:/Users/mas/Anaconda3/envs/nw_env/Lib/R/library")
detach("package:rlang", unload=TRUE)
library("rlang", lib.loc="C:/Users/mas/Anaconda3/envs/nw_env/Lib/R/library")
airports <- read.csv(paste(URL, "airport.csv", sep=""), header=T, fileEncoding="cp932")
URL <- "http://snatool.g2.xrea.com/sampledata/"
airports <- read.csv(paste(URL, "airport.csv", sep=""), header=T, fileEncoding="cp932")
flights <- read.csv(paste(URL, "top50.csv", sep=""), header=T, fileEncoding="cp932")
edgelist <- as.matrix(flights[, 1:2])
t(edgelist)
as.vector(t(edgelist))
edgelist
t(edgelist)
as.vector(t(edgelist))
as.vector(t(edgelist))
col <- c("darkgoldenrod1", "cyan2")
windows(width=12)
head(flithts)
head(flights)
arcplot(edgelist, lwd.arcs=flights[,3]/10^6, labels=names,
ordering=as.vector(airports$airport), col.label="grey30",
col.arcs=hsv(0, 0, 0.2, 0.25), cex.nodes=2,
col.nodes=col[as.integer(airports[names,"type"])],
pch.nodes=18 - col[as.integer(airports[names,"type"])]))
arcplot(edgelist, lwd.arcs=flights[,3]/10^6, labels=names,
ordering=as.vector(airports$airport), col.label="grey30",
col.arcs=hsv(0, 0, 0.2, 0.25), cex.nodes=2,
col.nodes=col[as.integer(airports[names,"type"])],
pch.nodes=18 - as.integer(airports[names,"type"]))
edgelist
flights[,3]
airports$airport
col[as.integer(airports[names,"type"])]
airports[names,"type"])
airports[names,"type"]
airports
names
unique(as.vector(t(edgelist)))
names <- unique(as.vector(t(edgelist)))
names
arcplot(edgelist, lwd.arcs=flights[,3]/10^6, labels=names,
ordering=as.vector(airports$airport), col.label="grey30",
col.arcs=hsv(0, 0, 0.2, 0.25), cex.nodes=2,
col.nodes=col[as.integer(airports[names,"type"])],
pch.nodes=18 - as.integer(airports[names,"type"]))
windows(width=12)
arcplot(edgelist, lwd.arcs=flights[,3]/10^6, labels=names,
ordering=as.vector(airports$airport), col.label="grey30",
col.arcs=hsv(0, 0, 0.2, 0.25), cex.nodes=2,
col.nodes=col[as.integer(airports[names,"type"])],
pch.nodes=18 - as.integer(airports[names,"type"]))
18 - as.integer(airports[names,"type"]
18 - as.integer(airports[names,"type"])
18 - as.integer(airports[names,"type"])
airports[names,"type"]
airports[names,"type"]
airports
names
col
class(airports)
airports$airport == names
names
airports$airport
airports
airports$airport in names
as.vector(airports$airport)
airports[names,"type"]
names
airports[,"type"])
airports[,"type"]
as.integer(airports[,"type"])
arcplot(edgelist, lwd.arcs=flights[,3]/10^6, labels=names,
ordering=as.vector(airports$airport), col.label="grey30",
col.arcs=hsv(0, 0, 0.2, 0.25), cex.nodes=2,
col.nodes=col[as.integer(airports[,"type"])],
pch.nodes=18 - as.integer(airports[,"type"]))
#ハイブプロット
#ノードの座標に意味がある
ADVICE <- matrix(c(
0,1,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0,1,0,0,1,
0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,
1,1,0,1,0,1,1,1,1,1,1,1,0,1,0,0,1,1,0,1,1,
1,1,0,0,0,1,0,1,0,1,1,1,0,0,0,1,1,1,0,1,1,
1,1,0,0,0,1,1,1,0,1,1,0,1,1,0,1,1,1,1,1,1,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,
0,1,0,0,0,1,0,0,0,0,1,1,0,1,0,0,1,1,0,0,1,
0,1,0,1,0,1,1,0,0,1,1,0,0,0,0,0,0,1,0,0,1,
1,1,0,0,0,1,1,1,0,1,1,1,0,1,0,1,1,1,0,0,1,
1,1,1,1,1,0,0,1,0,0,1,0,1,0,1,1,1,1,1,1,0,
1,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,
1,1,0,0,1,0,0,0,1,0,0,0,0,1,0,0,0,1,0,0,0,
0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,1,0,0,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,
1,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,
1,1,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,
1,1,1,1,1,0,1,1,1,1,1,0,1,1,1,1,0,0,1,1,1,
1,1,1,0,1,0,1,0,0,1,1,0,0,1,1,0,0,1,0,1,0,
1,1,0,0,0,1,0,1,0,0,1,1,0,1,1,1,1,1,0,0,1,
0,1,1,1,0,1,1,1,0,0,0,1,0,1,0,0,1,1,0,1,0),
nrow = 21, byrow = TRUE)
tenure <- c(9.333,19.583,12.75,7.5,3.333,
28,30,11.333,5.417,9.25,27,8.917,0.25,10.417,
8.417,4.667,12.417,9.083,4.833,11.667,12.5)
dpt <- c(4,4,2,4,2,1,0,1,2,3,3,1,2,2,2,4,1,3,2,2,1)
level <- c(3,2,3,3,3,3,1,3,3,3,3,3,3,2,3,3,3,2,3,3,2)
shapes(ADVICE)
dim(ADVICE)
length(tenure)
length(dpt)
length(level)
install.packages("HiveR")
library(HiveR)
library(RColorBrewer)
rownames(ADVICE)
rownames(ADVICE) <- 1:nrow(ADVICE)
colnames(ADVICE) <- 1:ncol(ADVICE)
advHPD <- adj2HPD(ADVICE + t(ADVICE))
ADVICE + t(ADVICE)
dpt + 1
advHPD$nodes$axis <- as.integer(dpt + 1)
tenure
advHPD$raduys <- tenure
advHPD$radus <- tenure
advHPD$radius <- tenure
colSums(ADVICE)
advHPD$colSums(ADVICE)/10
advHPD <- adj2HPD(ADVICE + t(ADVICE))
advHPD$nodes$axis <- as.integer(dpt + 1)
advHPD$nodes$radius <- tenure
advHPD$nodes$colSums(ADVICE)/10
advHPD$nodes$size <- colSums(ADVICE)/10
advHPD$nodes$color <- brewer.pal(3, "Greys")[level]
brewer.pal(3, "Greys")[level]
head(advHPD)
head(advHPD$nodes)
advHPD$edges$color <- brewer.pal(3, "Set2")[advHPD$edges$weight]
head(advHPD$edges)
RColorBrewer::brewer.pal(5, "Set1")
plotHive(advHPD, ch=0, bkgnd="grey10",
axLabs=paste("Dpt.", 0:4), axLab.pos=5)
plotHive(advHPD, ch=0, bkgnd="grey10",
axLabs=paste("Dpt.", 0:4), axLab.pos=1,
rot=c(90, -18, 54, -54, 18))
plotHive(advHPD, ch=0, method="rank", bkgnd="grey10",
axLabs=paste("Dpt.", 0:4), axLab.pos=1,
rot=c(90, -18, 54, -54, 18))
plotHive(advHPD, ch=0, bkgnd="grey10",
axLabs=paste("Dpt.", 0:4), axLab.pos=5)
library(igraph)
advice_igraph <- graph_from_adjacency_matrix(ADVICE)
V(advice_igraph)$tenure <- tenure
V(advice_igraph)$dpt <- paste("Dpt.", dpt)
library(ggraph)
ggraph(advice_igraph, layout="hive", axis="dpt", sort.by="tenure") +
geom_edge_hive(aes(alpha=..index..), show.legend=F) +
geom_node_point() +
geom_axis_hive() +
coord_fixed() +
theme_graph()
ggraph(advice_igraph, layout='hive', axis="dpt", sort.by="tenure") +
geom_edge_hive(aes(alpha=..index..), show.legend=F) +
geom_node_point() +
geom_axis_hive() +
coord_fixed() +
theme_graph()
library(ggraph)
ligrary(purrr)
install.packages("purrr")
ligrary(purrr)
library(purrr)
library(ggraph)
ggraph(advice_igraph, layout='hive', axis="dpt", sort.by="tenure") +
geom_edge_hive(aes(alpha=..index..), show.legend=F) +
geom_node_point() +
geom_axis_hive() +
coord_fixed() +
theme_graph()
advice_igraph <- graph_from_adjacency_matrix(ADVICE)
V(advice_igraph)$tenure <- tenure
V(advice_igraph)$dpt <- paste("Dpt.", dpt)
ggraph(advice_igraph, layout='hive', axis="dpt", sort.by="tenure") +
geom_edge_hive(aes(alpha=..index..), show.legend=F) +
geom_node_point() +
geom_axis_hive() +
coord_fixed() +
theme_graph()
advice_igraph
plot(acvice_igraph)
plot(advice_igraph)
ggraph(advice_igraph, layout='hive', axis="dpt", sort.by="tenure") +
geom_edge_hive(aes(alpha=..index..), show.legend=F) +
geom_node_point() +
geom_axis_hive() +
coord_fixed() +
theme_graph()
ggraph(advice_igraph, layout='hive', axis="dpt", sort.by="tenure")
ggraph(advice_igraph, layout='hive', axis="dpt", sort.by="tenure") +
geom_edge_hive(aes(alpha=..index..), show.legend=F) +
geom_node_point() +
geom_axis_hive() +
coord_fixed() +
theme_graph()
advice_igraph
ggraph(advice_igraph, layout="hive", axis="dpt", sort.by="tenure") +
geom_edge_hive(aes(alpha=..index..), show.legend=F) +
geom_node_point() +
geom_axis_hive() +
coord_fixed() +
theme_graph()
plot(advice_igraph)
ggraph(advice_igraph, layout='hive', axis="dpt", sort.by="tenure") +
geom_edge_hive(aes(alpha=..index..), show.legend=F) +
geom_node_point() +
geom_axis_hive() +
coord_fixed() +
theme_graph()
?ggraph
ggraph(advice_igraph, layout=hive, axis="dpt", sort.by="tenure") +
geom_edge_hive(aes(alpha=..index..), show.legend=F) +
geom_node_point() +
geom_axis_hive() +
coord_fixed() +
theme_graph()
ggraph(advice_igraph, layout="hive", axis="dpt", sort.by="tenure") +
geom_edge_hive(aes(alpha=..index..), show.legend=F) +
geom_node_point() +
geom_axis_hive() +
coord_fixed() +
theme_graph()
ggraph(advice_igraph, layout="hive", axis="dpt", sort.by="tenure") +
geom_edge_hive(aes(alpha=index), show.legend=F) +
geom_node_point() +
geom_axis_hive() +
coord_fixed() +
theme_graph()
ggraph(advice_igraph, layout="hive", axis="dpt", sort.by="tenure") +
geom_edge_hive(aes(alpha=..index), show.legend=F) +
geom_node_point() +
geom_axis_hive() +
coord_fixed() +
theme_graph()
..index..
ggraph(advice_igraph, layout="hive", axis="dpt", sort.by="tenure") +
geom_edge_hive(aes(alpha=..index..), show.legend=F) +
geom_node_point() +
geom_axis_hive() +
coord_fixed() +
theme_graph()
ggraph(advice_igraph, layout="hive", axis="dpt", sort.by="tenure") +
geom_edge_hive(aes(alpha=..index..), show.legend=FALSE) +
geom_node_point() +
geom_axis_hive() +
coord_fixed() +
theme_graph()
ggraph(advice_igraph, layout="hive", axis="dpt", sort.by="tenure") +
theme_graph()
ggraph(advice_igraph, layout="hive", axis="dpt", sort.by="tenure") +
coord_fixed() +
theme_graph()
ggraph(advice_igraph, layout="hive", axis="dpt", sort.by="tenure") +
geom_edge_hive(aes(alpha=..index..), show.legend=FALSE) +
ggraph(advice_igraph, layout="hive", axis="dpt", sort.by="tenure") +
geom_edge_hive(aes(alpha=..index..), show.legend=FALSE)
ggraph(advice_igraph, layout="hive", axis="dpt", sort.by="tenure") +
geom_edge_hive(aes(alpha=..index..), show.legend=FALSE) +
geom_node_point()
ggraph(advice_igraph, layout="hive", axis="dpt", sort.by="tenure") +
geom_edge_hive(aes(alpha=..index..), show.legend=FALSE) +
geom_node_point() +
geom_axis_hive()
ggraph(advice_igraph, layout="hive", axis="dpt", sort.by="tenure") +
geom_edge_hive(aes(alpha=..index..), show.legend=FALSE) +
geom_node_point() +
geom_axis_hive() +
coord_fixed()
ggraph(advice_igraph, layout="hive", axis="dpt", sort.by="tenure") +
geom_edge_hive(aes(alpha=..index..), show.legend=FALSE) +
geom_node_point() +
geom_axis_hive() +
coord_fixed() +
theme_graph()
advice_igraph
library(ggraph)
ggraph(advice_igraph, layout="hive", axis="dpt", sort.by="tenure") +
geom_edge_hive(aes(alpha=..index..), show.legend=FALSE) +
geom_node_point() +
geom_axis_hive() +
coord_fixed() +
theme_graph()
ggraph(advice_igraph, layout = "hive", axis = "dpt", sort.by = "tenure") +
geom_edge_hive(aes(alpha = ..index..), show.legend = FALSE) +
geom_node_point() +
geom_axis_hive() +
coord_fixed() +
theme_graph()
library(sna)
library(network)URL <- "http://snatool.g2.xrea.com/sampledata/"
library(network)
URL <- "http://snatool.g2.xrea.com/sampledata/"
flights <- read.csv(paste(URL, "top50.csv", sep=""), header=T, fileEncoding="cp932")
flights.net <- network(flights[, 1:2], directed = FALSE)
flights.net
pdf(file="airports.pdf", family="Japan1")
gplot(flights.net, gmode="graph", vertex.cex=0,
edge.col="grey50", displaylabels=T, label.pos=5)
dev.off()
gplot(flights.net, gmode="graph", vertex.cex=0,
edge.col="grey50", displaylabels=T, label.pos=5)
pdf(file="airports.pdf", family="Japan1")
gplot(flights.net, gmode="graph", vertex.cex=0,
edge.col="grey50", displaylabels=T, label.pos=5)
#11.6
library(sna)
library(network)
URL <- "http://snatool.g2.xrea.com/sampledata/"
flights <- read.csv(paste(URL, "top50.csv", sep = ""),
header = TRUE, fileEncoding = "cp932")
flights.net <- network(flights[,1:2], directed = FALSE)
pdf(file = "airports.pdf", family = "Japan1")
gplot(flights.net, gmode = "graph", vertex.cex = 0,
edge.col = "grey50", displaylabels =TRUE,label.pos = 5)
dev.off()
getwd()
getwd()
library(dlm)
library(KFAS)
library(ggplot2)
library(ggfortify)
library(ggfortify)
getwd()
library(dlm)
install.packages("dlm")
install.packages("KFAS")
library(KFAS)
library(ggplot2)
library(ggfortify)
Nile
length(Nile)
KfLocalLevel <- function(y, mu_pre, P_pre, sigma_w, sigma_v){
#予測
mu_forecast <- mu_pre
P_forecast <- P_pre + sigma_w
y_forecast <- mu_forecast
F <- P_forecast + sigma_v
#フィルタリング
K <- P_forecast / (P_forecast + sigma_v)
y_resid <- y - y_forecast
mu_filter <- mu_forecast + K * y_resid
P_filter <- (1 - K) * P_forecast
result <- data.frame(
mu_filter = mu_filter,
P_filter = P_filter,
y_resid = y_resid,
F = F,
K = K
)
return(result)
}
N <- length(Nile)
mu_filter <- numeric(N)
mu_zero <- 0
mu_filter <- c(mu_zero, mu_filter)
P_filter <- numeric(N)
P_filter <- c(P_zero, P_filter)
P_zero <- 10000000
P_filter <- c(P_zero, P_filter)
y_resid <- numeric(N)
F <- numeric(N)
K <- numeric(N)
sigma_v <- 1000
sigma_v <- 1000
sigma_v <- 10000
#パラメタ
sigma_w <- 1000
library(dlm)
library(KFAS)
library(ggplot2)
library(ggfortify)
Nile
length(Nile)
KfLocalLevel <- function(y, mu_pre, P_pre, sigma_w, sigma_v){
#予測
mu_forecast <- mu_pre
P_forecast <- P_pre + sigma_w
y_forecast <- mu_forecast
F <- P_forecast + sigma_v
#フィルタリング
K <- P_forecast / (P_forecast + sigma_v)
y_resid <- y - y_forecast
mu_filter <- mu_forecast + K * y_resid
P_filter <- (1 - K) * P_forecast
result <- data.frame(
mu_filter = mu_filter,
P_filter = P_filter,
y_resid = y_resid,
F = F,
K = K
)
return(result)
}
N <- length(Nile)
#フィルタ化推定量
mu_filter <- numeric(N)
mu_zero <- 0
mu_filter <- c(mu_zero, mu_filter)
#フィルタ化推定量の誤差分散
P_filter <- numeric(N)
P_zero <- 10000000
P_filter <- c(P_zero, P_filter)
y_resid <- numeric(N)
F <- numeric(N)
K <- numeric(N)
#パラメタ
sigma_w <- 1000
sigma_v <- 10000
F
kekka <- KfLocalLevel(
y = Nile[i], mu_pre = mu_filter[i], P_pre = P_filter[i],
sigma_w=sigma_w, sigma_v=sigma_v
)
N
for(i in 1:N){
kekka <- KfLocalLevel(
y = Nile[i], mu_pre = mu_filter[i], P_pre = P_filter[i],
sigma_w=sigma_w, sigma_v=sigma_v
)
#フィルタ化推定量
mu_filter[i + 1] <- kekka$mu_filter
#フィルタ化推定量の誤差分散
P_filter[i + 1] <-  kekka$P_filter
#予測誤差
y_resid[i] <- kekka$y_resid
#予測誤差の分散
F[i] <- kekka$F
#カルマンゲイン
K[i] <- kekka$K
}
plot(Nile)
gplot(Nile)
autoplot(Nile)
autoplot(mu_filter)
mu_filter
plot(mu_filter)
autoplot(ts(mu_filter))
autoplot(ts(mu_filter[-1]))
autoplot(Nile)
Nile
autoplot(Nile, xlim(1850, 2000))
autoplot(Nile, xlim=(1850, 2000))
autoplot(ts(mu_filter[-1]))
ts(mu_filter[-1], start=1871)
autoplot(ts(mu_filter[-1], start=1871))
autoplot(ts(mu_filter[-1], start=1871))
autoplot(Nile, xlim=c(1850, 2000), ylim=c(400, 1400), , xlim=c(1850, 2000), ylim=c(400, 1400))
autoplot(Nile, xlim=c(1850, 2000), ylim=c(400, 1400), col="#ff000020")
?autoplot
autoplot(Nile, xlim=c(1850, 2000), ylim=c(400, 1400), colour="#ff000020")
autoplot(Nile, xlim=c(1850, 2000), ylim=c(400, 1400), colour="#ff000030")
autoplot(Nile, xlim=c(1850, 2000), ylim=c(400, 1400), colour="#ff000040")
autoplot(ts(mu_filter[-1], start=1871), xlim=c(1850, 2000), ylim=c(400, 1400),
colour="#0000ff40")
autoplot(Nile, xlim=c(1850, 2000), ylim=c(400, 1400), colour="#ff000040")
par(new=T)
autoplot(ts(mu_filter[-1], start=1871), xlim=c(1850, 2000), ylim=c(400, 1400),
colour="#0000ff40")
autoplot(Nile, xlim=c(1850, 2000), ylim=c(400, 1400), colour="#ff000040")
# ggplot ------------------------------------------------------------------
library(ggplot2)
df <- diamonds
#散布図
ggplot(df, aes(x=carat, y=price)) +
geom_point()
?aes
ggsave(filename="test.png", width=10, height=8, units="cm", dpi=100)
#散布図
ggplot(df, aes(x=carat, y=price)) +
geom_point() +
ggsave(filename="test.png", width=10, height=8, units="cm", dpi=100)
#散布図
g <- ggplot(df, aes(x=carat, y=price)) +
geom_point()
ggsave(filename="test.png", plot=g, width=10, height=8, units="cm", dpi=100)
ggsave(filename="test.jpg", plot=g, width=10, height=8, units="cm", dpi=100)
